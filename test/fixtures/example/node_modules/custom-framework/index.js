const { Application: _Application, Agent, startCluster: originStartCluster } = require('egg');

module.exports = {
  Agent,
  Application: class CustomApplication extends _Application {
    get [Symbol.for('egg#eggPath')]() {
      return __dirname;
    }
  },
  startCluster(...args) {
    if (process.env.CUSTOM_ENV && !process.env.EGG_SERVER_ENV) {
      console.log('## EGG_SERVER_ENV is not pass');
      console.log('## CUSTOM_ENV:', process.env.CUSTOM_ENV);
      process.env.EGG_SERVER_ENV = process.env.CUSTOM_ENV;
    }
    return originStartCluster(...args);
  },
};
