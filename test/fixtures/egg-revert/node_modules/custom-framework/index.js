const { Application: _Application, Agent, startCluster: originStartCluster } = require('egg');

const EGG_PATH = Symbol.for('egg#eggPath');

class Application extends _Application {
  get [EGG_PATH]() {
    return __dirname;
  }
}

function startCluster(...args) {
  if (process.env.CUSTOM_ENV && !process.env.EGG_SERVER_ENV) {
    console.log('## EGG_SERVER_ENV is not pass');
    console.log('## CUSTOM_ENV:', process.env.CUSTOM_ENV);
    process.env.EGG_SERVER_ENV = process.env.CUSTOM_ENV;
  }
  return originStartCluster(...args);
}

module.exports = {
  Application,
  Agent,
  startCluster,
};
